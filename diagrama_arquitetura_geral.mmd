graph TB
    %% Clientes
    subgraph "Clientes"
        Mobile[ğŸ“± App Mobile<br/>Flutter iOS/Android]
        Web[ğŸŒ App Web<br/>Flutter Web]
        WA[ğŸ“ WhatsApp<br/>Business API]
    end

    %% API Gateway
    Gateway[ğŸšª API Gateway<br/>Kong/AWS API Gateway<br/>- AutenticaÃ§Ã£o JWT<br/>- Rate Limiting<br/>- Logging<br/>- Roteamento]

    %% MicroserviÃ§os
    subgraph "MicroserviÃ§os"
        AuthSvc[ğŸ” ServiÃ§o AutenticaÃ§Ã£o<br/>- Registro/Login<br/>- JWT Tokens<br/>- SessÃµes]
        
        NoteSvc[ğŸ“ ServiÃ§o AnotaÃ§Ãµes<br/>- CRUD AnotaÃ§Ãµes<br/>- CategorizaÃ§Ã£o<br/>- Busca<br/>- SincronizaÃ§Ã£o]
        
        AISvc[ğŸ¤– ServiÃ§o IA<br/>- ChatGPT Integration<br/>- Perplexity Integration<br/>- Processamento AssÃ­ncrono<br/>- Cache Resultados]
        
        WhatsAppSvc[ğŸ’¬ ServiÃ§o WhatsApp<br/>- Webhook Handler<br/>- Processamento MÃ­dia<br/>- Envio Mensagens<br/>- AssociaÃ§Ã£o UsuÃ¡rios]
        
        NotifSvc[ğŸ”” ServiÃ§o NotificaÃ§Ãµes<br/>- Push Notifications<br/>- Email Transacional<br/>- Templates<br/>- Tracking]
    end

    %% Message Broker
    Broker[ğŸ“¨ Message Broker<br/>Redis Pub/Sub<br/>- Eventos Sistema<br/>- SincronizaÃ§Ã£o<br/>- Processamento AssÃ­ncrono]

    %% Armazenamento
    subgraph "Armazenamento"
        PostgreSQL[(ğŸ˜ PostgreSQL<br/>Dados Relacionais<br/>- UsuÃ¡rios<br/>- Metadados<br/>- SessÃµes)]
        
        MongoDB[(ğŸƒ MongoDB<br/>Dados NÃ£o Estruturados<br/>- AnotaÃ§Ãµes<br/>- ConteÃºdo MÃ­dia<br/>- Logs)]
        
        Redis[(âš¡ Redis<br/>Cache & SessÃµes<br/>- Cache API<br/>- SessÃµes Ativas<br/>- Rate Limiting)]
        
        Elasticsearch[(ğŸ” Elasticsearch<br/>Busca Textual<br/>- Ãndices AnotaÃ§Ãµes<br/>- Busca Full-Text<br/>- AgregaÃ§Ãµes)]
    end

    %% APIs Externas
    subgraph "APIs Externas"
        OpenAI[ğŸ§  OpenAI<br/>ChatGPT API<br/>- CategorizaÃ§Ã£o<br/>- Insights<br/>- AnÃ¡lise]
        
        Perplexity[ğŸ” Perplexity<br/>Search API<br/>- Enriquecimento<br/>- Contexto Externo<br/>- Pesquisa Web]
        
        WhatsAppAPI[ğŸ“± WhatsApp<br/>Business API<br/>- Webhook<br/>- Envio/Recebimento<br/>- MÃ­dia]
    end

    %% ConexÃµes Clientes
    Mobile --> Gateway
    Web --> Gateway
    WA --> WhatsAppSvc

    %% ConexÃµes Gateway
    Gateway --> AuthSvc
    Gateway --> NoteSvc
    Gateway --> AISvc
    Gateway --> NotifSvc

    %% ConexÃµes ServiÃ§os
    AuthSvc --> PostgreSQL
    AuthSvc --> Redis
    
    NoteSvc --> PostgreSQL
    NoteSvc --> MongoDB
    NoteSvc --> Elasticsearch
    NoteSvc --> Broker
    
    AISvc --> OpenAI
    AISvc --> Perplexity
    AISvc --> Redis
    AISvc --> Broker
    
    WhatsAppSvc --> WhatsAppAPI
    WhatsAppSvc --> PostgreSQL
    WhatsAppSvc --> MongoDB
    WhatsAppSvc --> Broker
    
    NotifSvc --> Broker
    NotifSvc --> Redis

    %% SincronizaÃ§Ã£o via Broker
    Broker --> Mobile
    Broker --> Web

    %% Estilos
    classDef client fill:#e1f5fe
    classDef service fill:#f3e5f5
    classDef storage fill:#e8f5e8
    classDef external fill:#fff3e0
    classDef gateway fill:#fce4ec

    class Mobile,Web,WA client
    class AuthSvc,NoteSvc,AISvc,WhatsAppSvc,NotifSvc service
    class PostgreSQL,MongoDB,Redis,Elasticsearch storage
    class OpenAI,Perplexity,WhatsAppAPI external
    class Gateway gateway

